<h1>Productos en tiempo real</h1>

<form id="productForm">
    <input type="text" name="title" placeholder="Título" required />
    <input type="text" name="author" placeholder="Autor" required />
    <input type="number" name="price" placeholder="Precio" required />
    <input type="number" name="stock" placeholder="Stock" required />
    <input type="text" name="category" placeholder="Categoría" required />

    <button type="submit">Crear producto</button>
</form>

<hr>

<h2>Lista en vivo</h2>
<ul id="productList">
    {{#each products}}
      <li>
        Título: <b>{{this.title}}</b>  <br>
        Autor: <b>{{this.author}}</b>  <br>
        Precio: <b>${{this.price}}</b> <br> 
        Stock: <b>{{this.stock}}</b>  <br>
        Categoría: <b>{{this.category}}</b>
      </li>
    {{/each}}
</ul>

<script src="/socket.io/socket.io.js"></script>

<script>
    const socket = io();

    const form = document.getElementById("productForm");
    const productList = document.getElementById("productList");

    form.addEventListener("submit", (e) => {
        e.preventDefault();

        const formData = new FormData(form);
        const product = Object.fromEntries(formData);

        socket.emit("nuevoProducto", product);

        form.reset();
    });


    socket.on("productosActualizados", (products) => {
        productList.innerHTML = "";
        products.forEach(p => {
            productList.innerHTML +=  `
              <li>
                Título: <b>${p.title}</b>  <br>
                Autor: <b>${p.author}</b> <br>
                Precio: <b>$${p.price}</b>  <br>
                Stock: <b>${p.stock}</b>  <br>
                Categoría:<b>${p.category}</b>
              </li>`;
    });
    }); 
</script>
